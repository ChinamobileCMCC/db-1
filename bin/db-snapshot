#!/usr/bin/env sh

bin=$(dirname "$0")
. "${bin}/include/all"

if [ "${3}" = "--help" ]; then
  echo "SYNTAX: ${COLOR_LIGHT_BLUE}db snapshot [server shortname]${COLOR_NC}"
  echo "Makes a snapshot of the database at the provided database server"
  exit 1
fi

msg=${3}

shift 2

ts=$(date +%Y%m%d-%H%M%S)

if [ -z "${msg}" ]; then
  filename=${ts}
else
  filename=${ts}-${msg}
  shift
fi
file="${dumps}/${filename}.gz"

echo "${colored_shortname}"
"${bin}/drivers/${databasetype}/connectors/${connectiontype}/snapshot" "${project_root}" "${identifier}" "${file}" "$@"
code=$?

if [ "${code}" -eq 1 ]; then
  echo "${COLOR_RED}Could not make snapshot of database.${COLOR_NC}"
else
  echo "${COLOR_GREEN}Successfully made snapshot of database.${COLOR_NC}"
fi