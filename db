#!/bin/sh

option="${1}";
shift

db_dir=$(pwd)
while [[ ! -d "${db_dir}/.db" ]]; do

  if [ "${db_dir}" = "/" ]; then
    if [ "${option}" = "init" ]; then
      db_dir=$(pwd)
      break
    else
      echo "fatal: Not a db repository (or any of the parent directories). Please run 'db init'.";
      exit 2
    fi
  fi

  db_dir=$(cd "${db_dir}/.." && pwd)
done

me=$(dirname $(python -c 'import os,sys;print(os.path.realpath(sys.argv[1]))' $0))

# for synching database CONTENTS http://www.cri.ensmp.fr/~coelho/pg_comparator/pg_comparator.html
# for synching database STRUCTURE http://mmatuson.github.io/SchemaSync/ or http://search.cpan.org/dist/MySQL-Diff/bin/mysqldiff

cmd="${me}/bin/db-${option}"
if [[ -f ${cmd} ]]; then
  ${cmd} "${db_dir}" "$@"
else
  commands=$(ls -1 ${me}/bin | grep "db-" | cut -d "-" -f 2 | paste -s -d "|" -)
  echo "USAGE: db (${commands})"
  exit 1
fi